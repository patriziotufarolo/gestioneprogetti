
  ┌─┐
  ║"│
  └┬┘
  ┌┼┐
   │                     ┌─────┐                    ┌──────────┐                     ┌────────┐          ┌───────────────┐           ┌──────┐
  ┌┴┐                    │WebUI│                    │WebService│                     │Database│          │ContainerEngine│           │Kernel│
Utente                   └──┬──┘                    └────┬─────┘                     └───┬────┘          └───────┬───────┘           └──┬───┘
  │        1 deploy()       │                            │                               │                       │                      │
  │ ────────────────────────>                            │                               │                       │                      │
  │                         │                            │                               │                       │                      │
  │                         │     2 deployTopology()     │                               │                       │                      │
  │                         │ ───────────────────────────>                               │                       │                      │
  │                         │                            │                               │                       │                      │
  │                         │                            │                               │                       │                      │
  │                         │   ╔═════════════════╤══════╪═══════════════════════════════╪═══════════════════════╪══════════════════════╪═════════════════════════════════╗
  │                         │   ║ DEPLOY DEVICES  │      │                               │                       │                      │                                 ║
  │                         │   ╟─────────────────┘      │ 3 retrieveDevicesForTopology()│                       │                      │                                 ║
  │                         │   ║                        │ ──────────────────────────────>                       │                      │                                 ║
  │                         │   ║                        │                               │                       │                      │                                 ║
  │                         │   ║                        │       4 return(devices)       │                       │                      │                                 ║
  │                         │   ║                        │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                        │                      │                                 ║
  │                         │   ║                        │                               │                       │                      │                                 ║
  │                         │   ║                        │                               │                       │                      │                                 ║
  │                         │   ║         ╔═══════╤══════╪═══════════════════════════════╪═══════════════════════╪══════════════════════╪═══════════════════════╗         ║
  │                         │   ║         ║ LOOP  │  devices as device                   │                       │                      │                       ║         ║
  │                         │   ║         ╟───────┘      │                               │                       │                      │                       ║         ║
  │                         │   ║         ║              │               5 deployContainer(device)               │                      │                       ║         ║
  │                         │   ║         ║              │ ─────────────────────────────────────────────────────>│                      │                       ║         ║
  │                         │   ║         ║              │                               │                       │                      │                       ║         ║
  │                         │   ║         ║              │                               │                       │                      │                       ║         ║
  │                         │   ║         ║              │                               │     ╔══════╤══════════╪══════════════════════╪═════════════╗         ║         ║
  │                         │   ║         ║              │                               │     ║ PAR  │          │                      │             ║         ║         ║
  │                         │   ║         ║              │                               │     ╟──────┘          │   6 createNetNS()    │             ║         ║         ║
  │                         │   ║         ║              │                               │     ║                 │──────────────────────>             ║         ║         ║
  │                         │   ║         ║              │                               │     ║                 │                      │             ║         ║         ║
  │                         │   ║         ║              │                               │     ║                 │     7 createFS()     │             ║         ║         ║
  │                         │   ║         ║              │                               │     ║                 │──────────────────────>             ║         ║         ║
  │                         │   ║         ║              │                               │     ╚═════════════════╪══════════════════════╪═════════════╝         ║         ║
  │                         │   ║         ║              │                               │                       │                      │                       ║         ║
  │                         │   ║         ║              │                               │                       │                      │                       ║         ║
  │                         │   ║         ║              │                               │     ╔══════╤══════════╪══════════════════════╪═════════════╗         ║         ║
  │                         │   ║         ║              │                               │     ║ PAR  │          │                      │             ║         ║         ║
  │                         │   ║         ║              │                               │     ╟──────┘          │   8 return(NetNS)    │             ║         ║         ║
  │                         │   ║         ║              │                               │     ║                 │<─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─              ║         ║         ║
  │                         │   ║         ║              │                               │     ║                 │                      │             ║         ║         ║
  │                         │   ║         ║              │                               │     ║                 │     9 return(FS)     │             ║         ║         ║
  │                         │   ║         ║              │                               │     ║                 │<─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─              ║         ║         ║
  │                         │   ║         ║              │                               │     ╚═════════════════╪══════════════════════╪═════════════╝         ║         ║
  │                         │   ║         ║              │                               │                       │                      │                       ║         ║
  │                         │   ║         ║              │                               │                       │10 associate(NetNS,FS)│                       ║         ║
  │                         │   ║         ║              │                               │                       │──────────────────────>                       ║         ║
  │                         │   ║         ║              │                               │                       │                      │                       ║         ║
  │                         │   ║         ║              │                     11 return(ok)                     │                      │                       ║         ║
  │                         │   ║         ║              │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─│                      │                       ║         ║
  │                         │   ║         ╚══════════════╪═══════════════════════════════╪═══════════════════════╪══════════════════════╪═══════════════════════╝         ║
  │                         │   ╚════════════════════════╪═══════════════════════════════╪═══════════════════════╪══════════════════════╪═════════════════════════════════╝
  │                         │                            │                               │                       │                      │
  │                         │                            │                               │                       │                      │
  │                         │   ╔═══════════════╤════════╪═══════════════════════════════╪═══════════════════════╪══════════════════════╪═══════════════════════╗
  │                         │   ║ DEPLOY LINKS  │        │                               │                       │                      │                       ║
  │                         │   ╟───────────────┘        │ 12 retrieveLinksForTopology() │                       │                      │                       ║
  │                         │   ║                        │ ──────────────────────────────>                       │                      │                       ║
  │                         │   ║                        │                               │                       │                      │                       ║
  │                         │   ║                        │        13 return(links)       │                       │                      │                       ║
  │                         │   ║                        │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                        │                      │                       ║
  │                         │   ║                        │                               │                       │                      │                       ║
  │                         │   ║                        │                               │                       │                      │                       ║
  │                         │   ║         ╔═══════╤══════╪═══════════════════════════════╪═══════════════════════╪══════════════════════╪═════════════╗         ║
  │                         │   ║         ║ LOOP  │  links as link                       │                       │                      │             ║         ║
  │                         │   ║         ╟───────┘      │                               │                       │                      │             ║         ║
  │                         │   ║         ║              │                              14 createVethPair()      │                      │             ║         ║
  │                         │   ║         ║              │ ─────────────────────────────────────────────────────────────────────────────>             ║         ║
  │                         │   ║         ║              │                               │                       │                      │             ║         ║
  │                         │   ║         ║              │                               15 return(VethID)       │                      │             ║         ║
  │                         │   ║         ║              │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─             ║         ║
  │                         │   ║         ║              │                               │                       │                      │             ║         ║
  │                         │   ║         ║              │                  16 associateVethID(link.peer1, link.peer2)                  │             ║         ║
  │                         │   ║         ║              │ ─────────────────────────────────────────────────────────────────────────────>             ║         ║
  │                         │   ║         ║              │                               │                       │                      │             ║         ║
  │                         │   ║         ║              │                               │ 17 return(ok)         │                      │             ║         ║
  │                         │   ║         ║              │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─             ║         ║
  │                         │   ║         ╚══════════════╪═══════════════════════════════╪═══════════════════════╪══════════════════════╪═════════════╝         ║
  │                         │   ╚════════════════════════╪═══════════════════════════════╪═══════════════════════╪══════════════════════╪═══════════════════════╝
  │                         │                            │                               │                       │                      │
  │                         │ 18 return(deployedTopology)│                               │                       │                      │
  │                         │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                               │                       │                      │
  │                         │                            │                               │                       │                      │
  │ 19 show(deployedMessage)│                            │                               │                       │                      │
  │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                             │                               │                       │                      │
  │                         │                            │                               │                       │                      │

@startuml
hide footbox
autonumber

skinparam shadowing false
skinparam sequenceMessageAlign center
skinparam monochrome true


Actor Utente as u
participant WebUI as ui
participant WebService as ws
participant Database as d
participant ContainerEngine as c
participant Kernel as k

u->ui : deploy()
ui->ws : deployTopology()
group deploy devices
ws->d : retrieveDevicesForTopology()
ws<--d: return(devices)
loop devices as device
    ws-> c : deployContainer(device)
    group par
    c -> k : createNetNS()
    c -> k : createFS()
    end
    group par
    c <-- k : return(NetNS)
    c <-- k : return(FS)
    end par
    c -> k : associate(NetNS,FS)
    ws<--c : return(ok)
end
end
group deploy links
ws->d: retrieveLinksForTopology()
ws<--d : return(links)
loop links as link
    ws -> k : createVethPair()
    k --> ws : return(VethID)
    ws -> k : associateVethID(link.peer1, link.peer2)
    ws <-- k: return(ok)
end
end
ui <-- ws : return(deployedTopology)
u <-- ui : show(deployedMessage)
@enduml
