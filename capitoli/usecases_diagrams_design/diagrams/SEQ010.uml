
  ┌─┐
  ║"│
  └┬┘
  ┌┼┐
   │                       ┌─────┐                  ┌──────────┐                     ┌────────┐          ┌───────────────┐          ┌──────┐
  ┌┴┐                      │WebUI│                  │WebService│                     │Database│          │ContainerEngine│          │Kernel│
Utente                     └──┬──┘                  └────┬─────┘                     └───┬────┘          └───────┬───────┘          └──┬───┘
  │      1 do(terminate)      │                          │                               │                       │                     │
  │ ──────────────────────────>                          │                               │                       │                     │
  │                           │                          │                               │                       │                     │
  │                           │  2 terminateExperiment() │                               │                       │                     │
  │                           │ ─────────────────────────>                               │                       │                     │
  │                           │                          │                               │                       │                     │
  │                           │                          │                               │                       │                     │
  │                           │ ╔═════════════════╤══════╪═══════════════════════════════╪═══════════════════════╪═════════════════════╪═════════════════════════════════╗
  │                           │ ║ REMOVE DEVICES  │      │                               │                       │                     │                                 ║
  │                           │ ╟─────────────────┘      │ 3 retrieveDevicesForTopology()│                       │                     │                                 ║
  │                           │ ║                        │ ──────────────────────────────>                       │                     │                                 ║
  │                           │ ║                        │                               │                       │                     │                                 ║
  │                           │ ║                        │       4 return(devices)       │                       │                     │                                 ║
  │                           │ ║                        │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                        │                     │                                 ║
  │                           │ ║                        │                               │                       │                     │                                 ║
  │                           │ ║                        │                               │                       │                     │                                 ║
  │                           │ ║         ╔═══════╤══════╪═══════════════════════════════╪═══════════════════════╪═════════════════════╪═══════════════════════╗         ║
  │                           │ ║         ║ LOOP  │  devices as device                   │                       │                     │                       ║         ║
  │                           │ ║         ╟───────┘      │                               │                       │                     │                       ║         ║
  │                           │ ║         ║              │               5 removeContainer(device)               │                     │                       ║         ║
  │                           │ ║         ║              │ ─────────────────────────────────────────────────────>│                     │                       ║         ║
  │                           │ ║         ║              │                               │                       │                     │                       ║         ║
  │                           │ ║         ║              │                               │                       │                     │                       ║         ║
  │                           │ ║         ║              │                               │     ╔══════╤══════════╪═════════════════════╪═════════════╗         ║         ║
  │                           │ ║         ║              │                               │     ║ PAR  │          │                     │             ║         ║         ║
  │                           │ ║         ║              │                               │     ╟──────┘          │  6 removeNetNS()    │             ║         ║         ║
  │                           │ ║         ║              │                               │     ║                 │────────────────────>│             ║         ║         ║
  │                           │ ║         ║              │                               │     ║                 │                     │             ║         ║         ║
  │                           │ ║         ║              │                               │     ║                 │    7 removeFS()     │             ║         ║         ║
  │                           │ ║         ║              │                               │     ║                 │────────────────────>│             ║         ║         ║
  │                           │ ║         ║              │                               │     ╚═════════════════╪═════════════════════╪═════════════╝         ║         ║
  │                           │ ║         ║              │                               │                       │                     │                       ║         ║
  │                           │ ║         ║              │                               │                       │                     │                       ║         ║
  │                           │ ║         ║              │                               │     ╔══════╤══════════╪═════════════════════╪═════════════╗         ║         ║
  │                           │ ║         ║              │                               │     ║ PAR  │          │                     │             ║         ║         ║
  │                           │ ║         ║              │                               │     ╟──────┘          │    8 return(ok)     │             ║         ║         ║
  │                           │ ║         ║              │                               │     ║                 │<─ ─ ─ ─ ─ ─ ─ ─ ─ ─ │             ║         ║         ║
  │                           │ ║         ║              │                               │     ║                 │                     │             ║         ║         ║
  │                           │ ║         ║              │                               │     ║                 │    9 return(ok)     │             ║         ║         ║
  │                           │ ║         ║              │                               │     ║                 │<─ ─ ─ ─ ─ ─ ─ ─ ─ ─ │             ║         ║         ║
  │                           │ ║         ║              │                               │     ╚═════════════════╪═════════════════════╪═════════════╝         ║         ║
  │                           │ ║         ║              │                               │                       │                     │                       ║         ║
  │                           │ ║         ║              │                     10 return(ok)                     │                     │                       ║         ║
  │                           │ ║         ║              │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─│                     │                       ║         ║
  │                           │ ║         ╚══════════════╪═══════════════════════════════╪═══════════════════════╪═════════════════════╪═══════════════════════╝         ║
  │                           │ ╚════════════════════════╪═══════════════════════════════╪═══════════════════════╪═════════════════════╪═════════════════════════════════╝
  │                           │                          │                               │                       │                     │
  │                           │                          │                               │                       │                     │
  │                           │ ╔═══════════════╤════════╪═══════════════════════════════╪═══════════════════════╪═════════════════════╪═══════════════════════╗
  │                           │ ║ DEPLOY LINKS  │        │                               │                       │                     │                       ║
  │                           │ ╟───────────────┘        │ 11 retrieve(LinksForTopology) │                       │                     │                       ║
  │                           │ ║                        │ ──────────────────────────────>                       │                     │                       ║
  │                           │ ║                        │                               │                       │                     │                       ║
  │                           │ ║                        │        12 return(links)       │                       │                     │                       ║
  │                           │ ║                        │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                        │                     │                       ║
  │                           │ ║                        │                               │                       │                     │                       ║
  │                           │ ║                        │                               │                       │                     │                       ║
  │                           │ ║         ╔═══════╤══════╪═══════════════════════════════╪═══════════════════════╪═════════════════════╪═════════════╗         ║
  │                           │ ║         ║ LOOP  │  links as link                       │                       │                     │             ║         ║
  │                           │ ║         ╟───────┘      │                               │                       │                     │             ║         ║
  │                           │ ║         ║              │                             13 removeVethPair()       │                     │             ║         ║
  │                           │ ║         ║              │ ────────────────────────────────────────────────────────────────────────────>             ║         ║
  │                           │ ║         ║              │                               │                       │                     │             ║         ║
  │                           │ ║         ║              │                               │14 return(ok)          │                     │             ║         ║
  │                           │ ║         ║              │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─              ║         ║
  │                           │ ║         ╚══════════════╪═══════════════════════════════╪═══════════════════════╪═════════════════════╪═════════════╝         ║
  │                           │ ╚════════════════════════╪═══════════════════════════════╪═══════════════════════╪═════════════════════╪═══════════════════════╝
  │                           │                          │                               │                       │                     │
  │                           │ 15 terminatedExperiment()│                               │                       │                     │
  │                           │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                               │                       │                     │
  │                           │                          │                               │                       │                     │
  │ 16 show(TerminatedMessage)│                          │                               │                       │                     │
  │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─                           │                               │                       │                     │
  │                           │                          │                               │                       │                     │

@startuml
hide footbox
autonumber

skinparam shadowing false
skinparam sequenceMessageAlign center
skinparam monochrome true


Actor Utente as u
participant WebUI as ui
participant WebService as ws
participant Database as d
participant ContainerEngine as c
participant Kernel as k

u->ui : do(terminate)
ui->ws : terminateExperiment()
group remove devices
ws->d : retrieveDevicesForTopology()
ws<--d: return(devices)
loop devices as device
    ws-> c : removeContainer(device)
    group par
    c -> k : removeNetNS()
    c -> k : removeFS()
    end
    group par
    c <-- k : return(ok)
    c <-- k : return(ok)
    end par
    ws<--c : return(ok)
end
end
group deploy links
ws->d: retrieve(LinksForTopology)
ws<--d : return(links)
loop links as link
    ws -> k : removeVethPair()
    k --> ws : return(ok)
end
end
ui <-- ws : terminatedExperiment()
u <-- ui : show(TerminatedMessage)
@enduml
